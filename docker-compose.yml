version: "3.4"
services:
  db:
    image: postgres:9.6-alpine@sha256:215ad1cb0084e32ef2648394f8d08c9cfa29a86371ebe9e4c88b0dd51aa0bfdc
    environment:
      - POSTGRES_USER=caluma
      # following option is a must to configure on production system:
      # https://hub.docker.com/_/postgres
      # - POSTGRES_PASSWORD=
    volumes:
      - dbdata:/var/lib/postgresql/data
    command: -p ${DATABASE_PORT:-5432}
  caluma:
    image: projectcaluma/caluma:latest
    ports:
      - "8000:8000"
    depends_on:
      - db
    # Example to include custom extensions
    # volumes:
    #   - ./visibilities.py:/app/caluma/extensions/visibilities.py
    #   - ./permissions.py:/app/caluma/extensions/permissions.py
    #   - ./validations.py:/app/caluma/extensions/validations.py
    environment:
      - DATABASE_HOST=db
      # following options are a must to configure on production system:
      # https://docs.djangoproject.com/en/2.1/ref/settings/#std:setting-SECRET_KEY
      # - SECRET_KEY=
      # https://docs.djangoproject.com/en/2.1/ref/settings/#allowed-hosts
      # - ALLOWED_HOSTS=
      # https://docs.djangoproject.com/en/2.1/ref/settings/#password
      # same as postgres password above
      # - DATABASE_PASSWORD=
      # https://github.com/projectcaluma/caluma#visibility-classes
      # - VISIBILITY_CLASSES=
      # https://github.com/projectcaluma/caluma#permission-classes
      # - PERMISSION_CLASSES=

volumes:
  dbdata:
